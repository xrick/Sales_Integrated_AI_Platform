frontend
 New session created, question history cleared
mgfd_cursor:618 🔧 renderAssistantMessage called with: Object
mgfd_cursor:661 📄 Processing plain text response
mgfd_cursor:547 🔄 Received data from backend: Object
mgfd_cursor:561 📦 Detected standard response format
mgfd_cursor:618 🔧 renderAssistantMessage called with: Object
mgfd_cursor:661 📄 Processing plain text response
mgfd_cursor:547 🔄 Received data from backend: Object
mgfd_cursor:561 📦 Detected standard response format
mgfd_cursor:618 🔧 renderAssistantMessage called with: Object
mgfd_cursor:661 📄 Processing plain text response
mgfd_cursor:547 🔄 Received data from backend: Object
mgfd_cursor:561 📦 Detected standard response format
mgfd_cursor:618 🔧 renderAssistantMessage called with: Object
mgfd_cursor:661 📄 Processing plain text response
mgfd_cursor:547 🔄 Received data from backend: Object
mgfd_cursor:561 📦 Detected standard response format
mgfd_cursor:618 🔧 renderAssistantMessage called with: Object
mgfd_cursor:661 📄 Processing plain text response
mgfd_cursor:547 🔄 Received data from backend: Object
mgfd_cursor:561 📦 Detected standard response format
mgfd_cursor:618 🔧 renderAssistantMessage called with: Object
mgfd_cursor:661 📄 Processing plain text response
mgfd_cursor:547 🔄 Received data from backend: Object
mgfd_cursor:561 📦 Detected standard response format
mgfd_cursor:618 🔧 renderAssistantMessage called with: Object
mgfd_cursor:657 📋 Processing legacy recommendation format
mgfd_cursor:581 發送消息失敗: TypeError: Cannot read properties of undefined (reading 'toUpperCase')
    at mgfd_cursor:1060:57
    at Array.forEach (<anonymous>)
    at MGFDChat.formatRecommendations (mgfd_cursor:1055:37)
    at MGFDChat.renderAssistantMessage (mgfd_cursor:658:48)
    at MGFDChat.addMessage (mgfd_cursor:603:26)
    at MGFDChat.sendMessage (mgfd_cursor:575:26)


backend
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
2025-08-18 22:13:05,798 - api.mgfd_routes - INFO - Redis連接成功
2025-08-18 22:13:05,798 - libs.mgfd_cursor.mgfd_system - INFO - 初始化MGFD系統 (簡化版)...
2025-08-18 22:13:05,807 - libs.mgfd_cursor.llm_manager - INFO - 成功初始化 ollama LLM: deepseek-r1:7b
2025-08-18 22:13:05,807 - libs.mgfd_cursor.llm_manager - WARNING - 主提示不存在: /Users/xrickliao/WorkSpaces/Work/Projects/mlinfo_kb_platform/docs/Prompts/MGFD_Foundmental_Prompt.txt
2025-08-18 22:13:05,808 - libs.mgfd_cursor.enhanced_slot_extractor - INFO - 使用簡化版槽位提取器 (純LLM模式)
2025-08-18 22:13:05,808 - libs.mgfd_cursor.question_manager - INFO - 成功載入 11 個問題配置
2025-08-18 22:13:05,808 - libs.mgfd_cursor.response_generator - INFO - 使用簡化版回應生成器
2025-08-18 22:13:05,808 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 17_result.csv
2025-08-18 22:13:05,810 - libs.mgfd_cursor.knowledge_base - WARNING - 檔案 17_result.csv 沒有有效產品數據
2025-08-18 22:13:05,810 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 839_result.csv
2025-08-18 22:13:05,812 - libs.mgfd_cursor.knowledge_base - INFO - 從 839_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:05,812 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: AC01_result.csv
2025-08-18 22:13:05,813 - libs.mgfd_cursor.knowledge_base - WARNING - 檔案 AC01_result.csv 沒有有效產品數據
2025-08-18 22:13:05,813 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 928_result.csv
2025-08-18 22:13:05,814 - libs.mgfd_cursor.knowledge_base - INFO - 從 928_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:05,814 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 918_result.csv
2025-08-18 22:13:05,815 - libs.mgfd_cursor.knowledge_base - INFO - 從 918_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:05,815 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 531_result.csv
2025-08-18 22:13:05,817 - libs.mgfd_cursor.knowledge_base - INFO - 從 531_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:05,817 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 8329_result.csv
2025-08-18 22:13:05,818 - libs.mgfd_cursor.knowledge_base - INFO - 從 8329_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:05,818 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 525_result.csv
2025-08-18 22:13:05,819 - libs.mgfd_cursor.knowledge_base - INFO - 從 525_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:05,819 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 27_result.csv
2025-08-18 22:13:05,820 - libs.mgfd_cursor.knowledge_base - WARNING - 檔案 27_result.csv 沒有有效產品數據
2025-08-18 22:13:05,820 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 938_result.csv
2025-08-18 22:13:05,822 - libs.mgfd_cursor.knowledge_base - INFO - 從 938_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:05,822 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 728_result.csv
2025-08-18 22:13:05,823 - libs.mgfd_cursor.knowledge_base - WARNING - 檔案 728_result.csv 沒有有效產品數據
2025-08-18 22:13:05,823 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 960_result.csv
2025-08-18 22:13:05,824 - libs.mgfd_cursor.knowledge_base - INFO - 從 960_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:05,824 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 656_result.csv
2025-08-18 22:13:05,825 - libs.mgfd_cursor.knowledge_base - WARNING - 檔案 656_result.csv 沒有有效產品數據
2025-08-18 22:13:05,825 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 829_result.csv
2025-08-18 22:13:05,826 - libs.mgfd_cursor.knowledge_base - INFO - 從 829_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:05,826 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 326_result.csv
2025-08-18 22:13:05,827 - libs.mgfd_cursor.knowledge_base - WARNING - 檔案 326_result.csv 沒有有效產品數據
2025-08-18 22:13:05,827 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 835_result.csv
2025-08-18 22:13:05,828 - libs.mgfd_cursor.knowledge_base - INFO - 從 835_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:05,828 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 819_result.csv
2025-08-18 22:13:05,829 - libs.mgfd_cursor.knowledge_base - INFO - 從 819_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:05,829 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 958_result.csv
2025-08-18 22:13:05,830 - libs.mgfd_cursor.knowledge_base - INFO - 從 958_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:05,830 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 529_result.csv
2025-08-18 22:13:05,832 - libs.mgfd_cursor.knowledge_base - INFO - 從 529_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:05,832 - libs.mgfd_cursor.knowledge_base - INFO - 數據載入完成: 成功載入 13 個產品 (成功檔案: 13, 失敗檔案: 6)
2025-08-18 22:13:05,832 - libs.mgfd_cursor.knowledge_base - INFO - 初始化Chunking搜尋引擎...
2025-08-18 22:13:05,838 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-08-18 22:13:05,838 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2
2025-08-18 22:13:09,775 - libs.mgfd_cursor.chunking.parent_child.chunking_engine - INFO - 成功載入嵌入模型: sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2
2025-08-18 22:13:09,775 - libs.mgfd_cursor.chunking.parent_child.chunking_engine - INFO - 開始批量處理 13 個產品
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  8.27it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 46.89it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 82.33it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 91.77it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 19.27it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 90.38it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 97.42it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 87.95it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 19.28it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 84.92it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 91.01it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 94.35it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 90.45it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 19.46it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 19.73it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 85.48it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 84.55it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 90.27it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 91.96it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 19.62it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 88.79it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 93.39it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 93.25it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 92.80it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 18.75it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 89.30it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 92.90it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 94.44it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 18.30it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 90.09it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 70.40it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 91.80it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 94.34it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 90.21it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 18.28it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 90.28it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 95.63it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 93.90it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 98.45it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 98.21it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 99.52it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 98.58it/s]
Batches: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 100.80it/s]
Batches: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 103.45it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 70.74it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 97.26it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 98.59it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 99.49it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 18.58it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 93.06it/s]
2025-08-18 22:13:10,876 - libs.mgfd_cursor.chunking.parent_child.chunking_engine - INFO - 已處理 10/13 個產品
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 91.56it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 96.11it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 94.64it/s]
Batches: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 100.08it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 18.19it/s]
2025-08-18 22:13:10,978 - libs.mgfd_cursor.chunking.parent_child.chunking_engine - ERROR - 為產品創建分塊失敗: 'float' object has no attribute 'lower'
2025-08-18 22:13:10,979 - libs.mgfd_cursor.chunking.parent_child.chunking_engine - ERROR - 處理產品 11 失敗: 'float' object has no attribute 'lower'
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 88.17it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 97.94it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 95.87it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 98.97it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 72.63it/s]
2025-08-18 22:13:11,040 - libs.mgfd_cursor.chunking.parent_child.chunking_engine - INFO - 批量處理完成: 12 個父分塊, 48 個子分塊
2025-08-18 22:13:11,040 - libs.mgfd_cursor.knowledge_base - INFO - 完成產品分塊初始化：parents=12, children=48, embedded=60
2025-08-18 22:13:11,040 - libs.mgfd_cursor.mgfd_system - INFO - MGFD系統初始化完成 (簡化版)
2025-08-18 22:13:11,040 - api.mgfd_routes - INFO - MGFD系統初始化成功
/Users/xrickliao/WorkSpaces/Work/Projects/mlinfo_kb_platform/main.py:274: DeprecationWarning: 
        on_event is deprecated, use lifespan event handlers instead.

        Read more about it in the
        [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
        
  @app.on_event("startup")
/Users/xrickliao/WorkSpaces/Work/Projects/mlinfo_kb_platform/main.py:283: DeprecationWarning: 
        on_event is deprecated, use lifespan event handlers instead.

        Read more about it in the
        [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
        
  @app.on_event("shutdown")
INFO:     Will watch for changes in these directories: ['/Users/xrickliao/WorkSpaces/Work/Projects/mlinfo_kb_platform']
INFO:     Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)
INFO:     Started reloader process [42998] using WatchFiles
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
正在搜尋服務目錄: /Users/xrickliao/WorkSpaces/Work/Projects/mlinfo_kb_platform/libs/services
無法載入服務 'sales_assistant': No module named 'libs.services.sales_assistant.multichat'
/Users/xrickliao/miniconda3/miniconda3/envs/salesragenv/lib/python3.11/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
2025-08-18 22:13:13,735 - api.mgfd_routes - INFO - Redis連接成功
2025-08-18 22:13:13,735 - libs.mgfd_cursor.mgfd_system - INFO - 初始化MGFD系統 (簡化版)...
2025-08-18 22:13:13,744 - libs.mgfd_cursor.llm_manager - INFO - 成功初始化 ollama LLM: deepseek-r1:7b
2025-08-18 22:13:13,745 - libs.mgfd_cursor.llm_manager - WARNING - 主提示不存在: /Users/xrickliao/WorkSpaces/Work/Projects/mlinfo_kb_platform/docs/Prompts/MGFD_Foundmental_Prompt.txt
2025-08-18 22:13:13,745 - libs.mgfd_cursor.enhanced_slot_extractor - INFO - 使用簡化版槽位提取器 (純LLM模式)
2025-08-18 22:13:13,745 - libs.mgfd_cursor.question_manager - INFO - 成功載入 11 個問題配置
2025-08-18 22:13:13,745 - libs.mgfd_cursor.response_generator - INFO - 使用簡化版回應生成器
2025-08-18 22:13:13,745 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 17_result.csv
2025-08-18 22:13:13,747 - libs.mgfd_cursor.knowledge_base - WARNING - 檔案 17_result.csv 沒有有效產品數據
2025-08-18 22:13:13,747 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 839_result.csv
2025-08-18 22:13:13,749 - libs.mgfd_cursor.knowledge_base - INFO - 從 839_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:13,749 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: AC01_result.csv
2025-08-18 22:13:13,750 - libs.mgfd_cursor.knowledge_base - WARNING - 檔案 AC01_result.csv 沒有有效產品數據
2025-08-18 22:13:13,750 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 928_result.csv
2025-08-18 22:13:13,751 - libs.mgfd_cursor.knowledge_base - INFO - 從 928_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:13,751 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 918_result.csv
2025-08-18 22:13:13,752 - libs.mgfd_cursor.knowledge_base - INFO - 從 918_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:13,752 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 531_result.csv
2025-08-18 22:13:13,753 - libs.mgfd_cursor.knowledge_base - INFO - 從 531_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:13,753 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 8329_result.csv
2025-08-18 22:13:13,755 - libs.mgfd_cursor.knowledge_base - INFO - 從 8329_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:13,755 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 525_result.csv
2025-08-18 22:13:13,756 - libs.mgfd_cursor.knowledge_base - INFO - 從 525_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:13,756 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 27_result.csv
2025-08-18 22:13:13,757 - libs.mgfd_cursor.knowledge_base - WARNING - 檔案 27_result.csv 沒有有效產品數據
2025-08-18 22:13:13,757 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 938_result.csv
2025-08-18 22:13:13,758 - libs.mgfd_cursor.knowledge_base - INFO - 從 938_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:13,758 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 728_result.csv
2025-08-18 22:13:13,760 - libs.mgfd_cursor.knowledge_base - WARNING - 檔案 728_result.csv 沒有有效產品數據
2025-08-18 22:13:13,760 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 960_result.csv
2025-08-18 22:13:13,761 - libs.mgfd_cursor.knowledge_base - INFO - 從 960_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:13,761 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 656_result.csv
2025-08-18 22:13:13,762 - libs.mgfd_cursor.knowledge_base - WARNING - 檔案 656_result.csv 沒有有效產品數據
2025-08-18 22:13:13,762 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 829_result.csv
2025-08-18 22:13:13,763 - libs.mgfd_cursor.knowledge_base - INFO - 從 829_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:13,763 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 326_result.csv
2025-08-18 22:13:13,764 - libs.mgfd_cursor.knowledge_base - WARNING - 檔案 326_result.csv 沒有有效產品數據
2025-08-18 22:13:13,764 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 835_result.csv
2025-08-18 22:13:13,765 - libs.mgfd_cursor.knowledge_base - INFO - 從 835_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:13,765 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 819_result.csv
2025-08-18 22:13:13,766 - libs.mgfd_cursor.knowledge_base - INFO - 從 819_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:13,766 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 958_result.csv
2025-08-18 22:13:13,767 - libs.mgfd_cursor.knowledge_base - INFO - 從 958_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:13,767 - libs.mgfd_cursor.knowledge_base - INFO - 載入產品檔案: 529_result.csv
2025-08-18 22:13:13,769 - libs.mgfd_cursor.knowledge_base - INFO - 從 529_result.csv 成功載入 1 個有效產品
2025-08-18 22:13:13,769 - libs.mgfd_cursor.knowledge_base - INFO - 數據載入完成: 成功載入 13 個產品 (成功檔案: 13, 失敗檔案: 6)
2025-08-18 22:13:13,769 - libs.mgfd_cursor.knowledge_base - INFO - 初始化Chunking搜尋引擎...
2025-08-18 22:13:13,775 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: mps
2025-08-18 22:13:13,775 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2
2025-08-18 22:13:17,492 - libs.mgfd_cursor.chunking.parent_child.chunking_engine - INFO - 成功載入嵌入模型: sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2
2025-08-18 22:13:17,492 - libs.mgfd_cursor.chunking.parent_child.chunking_engine - INFO - 開始批量處理 13 個產品
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  8.39it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 86.64it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 88.79it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 43.90it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 19.56it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 89.38it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 92.89it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 91.18it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 19.27it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 90.99it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 94.78it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 90.86it/s]
Batches: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 100.37it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 19.92it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 19.86it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 95.60it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 93.84it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 93.22it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 92.70it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 20.17it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 94.21it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 94.90it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 94.06it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 94.66it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 18.47it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 91.14it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 92.64it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 93.54it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 18.32it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 88.97it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 70.16it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 92.59it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 90.61it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 89.04it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.88it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 88.54it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 91.71it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 92.00it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 92.96it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 93.09it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 93.55it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 93.22it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 90.45it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 89.32it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 72.47it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 94.83it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 94.08it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 92.22it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.61it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 92.93it/s]
2025-08-18 22:13:18,598 - libs.mgfd_cursor.chunking.parent_child.chunking_engine - INFO - 已處理 10/13 個產品
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 94.10it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 92.46it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 93.73it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 90.06it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 17.71it/s]
2025-08-18 22:13:18,704 - libs.mgfd_cursor.chunking.parent_child.chunking_engine - ERROR - 為產品創建分塊失敗: 'float' object has no attribute 'lower'
2025-08-18 22:13:18,704 - libs.mgfd_cursor.chunking.parent_child.chunking_engine - ERROR - 處理產品 11 失敗: 'float' object has no attribute 'lower'
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 89.70it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 92.77it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 92.52it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 89.30it/s]
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 67.55it/s]
2025-08-18 22:13:18,769 - libs.mgfd_cursor.chunking.parent_child.chunking_engine - INFO - 批量處理完成: 12 個父分塊, 48 個子分塊
2025-08-18 22:13:18,769 - libs.mgfd_cursor.knowledge_base - INFO - 完成產品分塊初始化：parents=12, children=48, embedded=60
2025-08-18 22:13:18,769 - libs.mgfd_cursor.mgfd_system - INFO - MGFD系統初始化完成 (簡化版)
2025-08-18 22:13:18,769 - api.mgfd_routes - INFO - MGFD系統初始化成功
INFO:     Started server process [43044]
INFO:     Waiting for application startup.
2025-08-18 22:13:18,802 - api.history_routes - INFO - History database initialized successfully
2025-08-18 22:13:18,802 - root - INFO - 🚀 MGFD SalesRAG Integration System 啟動中...
2025-08-18 22:13:18,802 - root - INFO - 📖 API文檔: http://0.0.0.0:8001/docs
2025-08-18 22:13:18,802 - root - INFO - 🔍 ReDoc文檔: http://0.0.0.0:8001/redoc
2025-08-18 22:13:18,802 - root - INFO - ✅ 系統啟動完成
2025-08-18 22:13:18,802 - api.history_routes - INFO - History database initialized successfully
INFO:     Application startup complete.
INFO:     127.0.0.1:56530 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:56530 - "GET /api/history/ HTTP/1.1" 200 OK
2025-08-18 22:13:35,675 - watchfiles.main - INFO - 1 change detected
INFO:     127.0.0.1:56530 - "GET /mgfd_cursor HTTP/1.1" 200 OK
2025-08-18 22:13:36,053 - api.mgfd_routes - INFO - 創建新會話: 40815e25-8c35-40d3-881d-2883e273a7f2
2025-08-18 22:13:36,054 - libs.mgfd_cursor.redis_state_manager - INFO - 刪除會話: 40815e25-8c35-40d3-881d-2883e273a7f2
INFO:     127.0.0.1:56530 - "POST /api/mgfd_cursor/session/create HTTP/1.1" 200 OK
2025-08-18 22:13:36,097 - api.mgfd_routes - INFO - 獲取系統統計資訊
2025-08-18 22:13:36,098 - libs.mgfd_cursor.redis_state_manager - ERROR - 清理過期會話失敗: 'str' object has no attribute 'decode'
INFO:     127.0.0.1:56530 - "GET /api/mgfd_cursor/stats HTTP/1.1" 200 OK
2025-08-18 22:13:41,725 - api.mgfd_routes - INFO - 處理聊天請求 - 會話ID: 40815e25-8c35-40d3-881d-2883e273a7f2, 消息: 請建輕便容易攜帶的筆電...
2025-08-18 22:13:41,725 - libs.mgfd_cursor.mgfd_system - INFO - ========== 開始處理會話 40815e25-8c35-40d3-881d-2883e273a7f2 的消息: 請建輕便容易攜帶的筆電... ==========
2025-08-18 22:13:41,725 - libs.mgfd_cursor.enhanced_slot_extractor - INFO - 增強型槽位提取，輸入: 請建輕便容易攜帶的筆電...
2025-08-18 22:13:41,726 - libs.mgfd_cursor.enhanced_slot_extractor - INFO - 槽位提取結果: {'timestamp': '2025-08-18T22:13:41.726159', 'user_input': '請建輕便容易攜帶的筆電', 'extracted_slots': {'portability_need': 'balanced'}, 'extraction_method': 'enhanced'}
2025-08-18 22:13:41,726 - libs.mgfd_cursor.user_input_handler - INFO - 完整槽位提取結果: {'extracted_slots': {'portability_need': 'balanced'}, 'extraction_method': 'enhanced_extraction'}
2025-08-18 22:13:41,726 - libs.mgfd_cursor.user_input_handler - INFO - 提取方法: enhanced_extraction
2025-08-18 22:13:41,726 - libs.mgfd_cursor.user_input_handler - INFO - 實際提取的槽位: {'portability_need': 'balanced'}
2025-08-18 22:13:41,726 - libs.mgfd_cursor.user_input_handler - INFO - 準備更新槽位: {'portability_need': 'balanced'}
2025-08-18 22:13:41,726 - libs.mgfd_cursor.user_input_handler - INFO - 槽位更新: portability_need = 'None' → 'balanced'
2025-08-18 22:13:41,726 - libs.mgfd_cursor.user_input_handler - INFO - 更新後的槽位狀態: {'portability_need': 'balanced'}
2025-08-18 22:13:41,727 - libs.mgfd_cursor.redis_state_manager - INFO - 保存會話狀態: 40815e25-8c35-40d3-881d-2883e273a7f2
2025-08-18 22:13:41,727 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 當前狀態檢查:
2025-08-18 22:13:41,727 - libs.mgfd_cursor.mgfd_system - INFO -   - filled_slots: {'portability_need': 'balanced'}
2025-08-18 22:13:41,727 - libs.mgfd_cursor.mgfd_system - INFO -   - awaiting_prompt_response: False
2025-08-18 22:13:41,727 - libs.mgfd_cursor.mgfd_system - INFO -   - current_prompt_step: None
2025-08-18 22:13:41,727 - libs.mgfd_cursor.mgfd_system - INFO -   - funnel_mode: False
2025-08-18 22:13:41,727 - libs.mgfd_cursor.mgfd_system - INFO -   - current_stage: awareness
2025-08-18 22:13:41,727 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 檢查是否觸發 funnel chat
2025-08-18 22:13:41,727 - libs.mgfd_cursor.mgfd_system - INFO - 觸發關鍵詞: 筆電
2025-08-18 22:13:41,727 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - _should_trigger_funnel_chat 結果: True
2025-08-18 22:13:41,727 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 觸發funnel chat模式，設置 funnel_mode=True
2025-08-18 22:13:41,727 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 決定下一步動作，funnel_mode: True
2025-08-18 22:13:41,727 - libs.mgfd_cursor.question_manager - INFO - 必填槽位未完成: usage_purpose
2025-08-18 22:13:41,727 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 槽位收集完成檢查: False
2025-08-18 22:13:41,728 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 繼續收集槽位
2025-08-18 22:13:41,728 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - _handle_slot_collection:
2025-08-18 22:13:41,728 - libs.mgfd_cursor.mgfd_system - INFO -   - current_slots: {'portability_need': 'balanced'}
2025-08-18 22:13:41,728 - libs.mgfd_cursor.mgfd_system - INFO -   - current_prompt_step: 1
2025-08-18 22:13:41,728 - libs.mgfd_cursor.mgfd_system - INFO -   - use_prompt_style: True
2025-08-18 22:13:41,728 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - should_skip_to_search: False
2025-08-18 22:13:41,728 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 使用Prompt風格，獲取步驟 1 的問題
2025-08-18 22:13:41,728 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 獲取到問題: {'step': 1, 'question': '首先，請問您購買這台新電腦，最主要的用途是什麼呢？這將幫助我判斷電腦需要的核心效能。', 'type': 'choice', 'slot_name': 'usage_purpose', 'options': [{'key': 'A', 'text': '日常文書處理與上網', 'value': 'document_processing'}, {'key': 'B', 'text': '影音娛樂', 'value': 'entertainment'}, {'key': 'C', 'text': '專業創作 (例如：修圖、影片剪輯)', 'value': 'creative'}, {'key': 'D', 'text': '電競遊戲', 'value': 'gaming'}, {'key': 'E', 'text': '商務辦公', 'value': 'business'}, {'key': 'F', 'text': '程式開發', 'value': 'programming'}], 'transition': ''}
2025-08-18 22:13:41,728 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 格式化問題文字: 首先，請問您購買這台新電腦，最主要的用途是什麼呢？這將幫助我判斷電腦需要的核心效能。

選項：
A) 日常文書處理與上網
B) 影音娛樂
C) 專業創作 (例如：修圖、影片剪輯)
D) 電競遊戲
E)...
2025-08-18 22:13:41,728 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 更新狀態設置: awaiting_prompt_response=True, current_prompt_step=1
2025-08-18 22:13:41,728 - libs.mgfd_cursor.redis_state_manager - INFO - 保存會話狀態: 40815e25-8c35-40d3-881d-2883e273a7f2
2025-08-18 22:13:41,728 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 狀態已保存完成
INFO:     127.0.0.1:56556 - "POST /api/mgfd_cursor/chat HTTP/1.1" 200 OK
2025-08-18 22:13:45,892 - api.mgfd_routes - INFO - 處理聊天請求 - 會話ID: 40815e25-8c35-40d3-881d-2883e273a7f2, 消息: c...
2025-08-18 22:13:45,893 - libs.mgfd_cursor.mgfd_system - INFO - ========== 開始處理會話 40815e25-8c35-40d3-881d-2883e273a7f2 的消息: c... ==========
2025-08-18 22:13:45,893 - libs.mgfd_cursor.redis_state_manager - INFO - 載入會話狀態: 40815e25-8c35-40d3-881d-2883e273a7f2
2025-08-18 22:13:45,894 - libs.mgfd_cursor.enhanced_slot_extractor - INFO - 增強型槽位提取，輸入: c...
2025-08-18 22:13:45,894 - libs.mgfd_cursor.enhanced_slot_extractor - INFO - 傳統提取未找到槽位，使用LLM智能分類
2025-08-18 22:13:45,894 - libs.mgfd_cursor.llm_manager - INFO - 執行槽位分類...
2025-08-18 22:13:45,894 - libs.mgfd_cursor.llm_manager - ERROR - 槽位分類失敗: 'MGFDLLMManager' object has no attribute '_get_from_cache'
2025-08-18 22:13:45,894 - libs.mgfd_cursor.enhanced_slot_extractor - WARNING - LLM分類置信度不足: 0.0
2025-08-18 22:13:45,894 - libs.mgfd_cursor.enhanced_slot_extractor - INFO - 槽位提取結果: {'timestamp': '2025-08-18T22:13:45.894437', 'user_input': 'c', 'extracted_slots': {}, 'extraction_method': 'failed'}
2025-08-18 22:13:45,894 - libs.mgfd_cursor.user_input_handler - INFO - 完整槽位提取結果: {'extracted_slots': {}, 'extraction_method': 'enhanced_extraction'}
2025-08-18 22:13:45,894 - libs.mgfd_cursor.user_input_handler - INFO - 提取方法: enhanced_extraction
2025-08-18 22:13:45,894 - libs.mgfd_cursor.user_input_handler - INFO - 實際提取的槽位: {}
2025-08-18 22:13:45,895 - libs.mgfd_cursor.redis_state_manager - INFO - 保存會話狀態: 40815e25-8c35-40d3-881d-2883e273a7f2
2025-08-18 22:13:45,895 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 當前狀態檢查:
2025-08-18 22:13:45,895 - libs.mgfd_cursor.mgfd_system - INFO -   - filled_slots: {'portability_need': 'balanced'}
2025-08-18 22:13:45,895 - libs.mgfd_cursor.mgfd_system - INFO -   - awaiting_prompt_response: True
2025-08-18 22:13:45,895 - libs.mgfd_cursor.mgfd_system - INFO -   - current_prompt_step: 1
2025-08-18 22:13:45,895 - libs.mgfd_cursor.mgfd_system - INFO -   - funnel_mode: True
2025-08-18 22:13:45,895 - libs.mgfd_cursor.mgfd_system - INFO -   - current_stage: awareness
2025-08-18 22:13:45,895 - libs.mgfd_cursor.mgfd_system - INFO - 等待回覆模式命中：step=1, slots={'portability_need': 'balanced'}
2025-08-18 22:13:45,895 - libs.mgfd_cursor.question_manager - INFO - DEBUG - QuestionManager.process_prompt_response:
2025-08-18 22:13:45,895 - libs.mgfd_cursor.question_manager - INFO -   - step: 1
2025-08-18 22:13:45,895 - libs.mgfd_cursor.question_manager - INFO -   - response: 'c'
2025-08-18 22:13:45,895 - libs.mgfd_cursor.question_manager - INFO -   - current_slots: {'portability_need': 'balanced'}
2025-08-18 22:13:45,895 - libs.mgfd_cursor.question_manager - INFO - DEBUG - 正規化輸入: 'c' -> upper: 'C'
2025-08-18 22:13:45,895 - libs.mgfd_cursor.question_manager - INFO - DEBUG - 字母鍵驗證結果: True
2025-08-18 22:13:45,895 - libs.mgfd_cursor.slot_mapping - INFO - Prompt轉換為槽位完成: 1 個槽位
2025-08-18 22:13:45,895 - libs.mgfd_cursor.question_manager - INFO - DEBUG - 步驟1字母鍵回覆成功: C -> {'usage_purpose': 'creative'}
2025-08-18 22:13:45,895 - libs.mgfd_cursor.question_manager - INFO - DEBUG - 最終更新後的槽位: {'portability_need': 'balanced', 'usage_purpose': 'creative'}
2025-08-18 22:13:45,895 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 槽位更新成功: {'portability_need': 'balanced'} -> {'portability_need': 'balanced', 'usage_purpose': 'creative'}
2025-08-18 22:13:45,896 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 狀態更新: awaiting_prompt_response=False, current_prompt_step=2
2025-08-18 22:13:45,896 - libs.mgfd_cursor.redis_state_manager - INFO - 保存會話狀態: 40815e25-8c35-40d3-881d-2883e273a7f2
2025-08-18 22:13:45,896 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 狀態已保存到 Redis
2025-08-18 22:13:45,896 - libs.mgfd_cursor.question_manager - INFO - 必填槽位未完成: budget_range
INFO:     127.0.0.1:56556 - "POST /api/mgfd_cursor/chat HTTP/1.1" 200 OK
2025-08-18 22:13:55,088 - api.mgfd_routes - INFO - 處理聊天請求 - 會話ID: 40815e25-8c35-40d3-881d-2883e273a7f2, 消息: d...
2025-08-18 22:13:55,088 - libs.mgfd_cursor.mgfd_system - INFO - ========== 開始處理會話 40815e25-8c35-40d3-881d-2883e273a7f2 的消息: d... ==========
2025-08-18 22:13:55,089 - libs.mgfd_cursor.redis_state_manager - INFO - 載入會話狀態: 40815e25-8c35-40d3-881d-2883e273a7f2
2025-08-18 22:13:55,089 - libs.mgfd_cursor.enhanced_slot_extractor - INFO - 增強型槽位提取，輸入: d...
2025-08-18 22:13:55,089 - libs.mgfd_cursor.enhanced_slot_extractor - INFO - 傳統提取未找到槽位，使用LLM智能分類
2025-08-18 22:13:55,089 - libs.mgfd_cursor.llm_manager - INFO - 執行槽位分類...
2025-08-18 22:13:55,089 - libs.mgfd_cursor.llm_manager - ERROR - 槽位分類失敗: 'MGFDLLMManager' object has no attribute '_get_from_cache'
2025-08-18 22:13:55,089 - libs.mgfd_cursor.enhanced_slot_extractor - WARNING - LLM分類置信度不足: 0.0
2025-08-18 22:13:55,089 - libs.mgfd_cursor.enhanced_slot_extractor - INFO - 槽位提取結果: {'timestamp': '2025-08-18T22:13:55.089886', 'user_input': 'd', 'extracted_slots': {}, 'extraction_method': 'failed'}
2025-08-18 22:13:55,089 - libs.mgfd_cursor.user_input_handler - INFO - 完整槽位提取結果: {'extracted_slots': {}, 'extraction_method': 'enhanced_extraction'}
2025-08-18 22:13:55,089 - libs.mgfd_cursor.user_input_handler - INFO - 提取方法: enhanced_extraction
2025-08-18 22:13:55,090 - libs.mgfd_cursor.user_input_handler - INFO - 實際提取的槽位: {}
2025-08-18 22:13:55,090 - libs.mgfd_cursor.redis_state_manager - INFO - 保存會話狀態: 40815e25-8c35-40d3-881d-2883e273a7f2
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 當前狀態檢查:
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO -   - filled_slots: {'portability_need': 'balanced', 'usage_purpose': 'creative'}
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO -   - awaiting_prompt_response: False
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO -   - current_prompt_step: 2
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO -   - funnel_mode: True
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO -   - current_stage: awareness
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 檢查是否觸發 funnel chat
2025-08-18 22:13:55,091 - libs.mgfd_cursor.question_manager - INFO - 必填槽位未完成: budget_range
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - _should_trigger_funnel_chat 結果: True
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 觸發funnel chat模式，設置 funnel_mode=True
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 決定下一步動作，funnel_mode: True
2025-08-18 22:13:55,091 - libs.mgfd_cursor.question_manager - INFO - 必填槽位未完成: budget_range
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 槽位收集完成檢查: False
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 繼續收集槽位
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - _handle_slot_collection:
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO -   - current_slots: {'portability_need': 'balanced', 'usage_purpose': 'creative'}
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO -   - current_prompt_step: 2
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO -   - use_prompt_style: True
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - should_skip_to_search: False
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 使用Prompt風格，獲取步驟 2 的問題
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 獲取到問題: {'step': 2, 'question': '了解了！接下來，請問您的預算大概是多少呢？', 'type': 'choice', 'slot_name': 'budget_range', 'options': [{'key': 'A', 'text': '25,000元 以下', 'value': 'budget'}, {'key': 'B', 'text': '25,001 - 40,000元', 'value': 'low_mid'}, {'key': 'C', 'text': '40,001 - 55,000元', 'value': 'mid_range'}, {'key': 'D', 'text': '55,001 - 70,000元', 'value': 'high_mid'}, {'key': 'E', 'text': '70,000元 以上', 'value': 'premium'}], 'transition': '了解了！接下來，'}
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 格式化問題文字: 了解了！接下來，了解了！接下來，請問您的預算大概是多少呢？

選項：
A) 25,000元 以下
B) 25,001 - 40,000元
C) 40,001 - 55,000元
D) 55,001 -...
2025-08-18 22:13:55,091 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 更新狀態設置: awaiting_prompt_response=True, current_prompt_step=2
2025-08-18 22:13:55,092 - libs.mgfd_cursor.redis_state_manager - INFO - 保存會話狀態: 40815e25-8c35-40d3-881d-2883e273a7f2
2025-08-18 22:13:55,092 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 狀態已保存完成
INFO:     127.0.0.1:56558 - "POST /api/mgfd_cursor/chat HTTP/1.1" 200 OK
2025-08-18 22:14:05,925 - api.mgfd_routes - INFO - 處理聊天請求 - 會話ID: 40815e25-8c35-40d3-881d-2883e273a7f2, 消息: c...
2025-08-18 22:14:05,925 - libs.mgfd_cursor.mgfd_system - INFO - ========== 開始處理會話 40815e25-8c35-40d3-881d-2883e273a7f2 的消息: c... ==========
2025-08-18 22:14:05,926 - libs.mgfd_cursor.redis_state_manager - INFO - 載入會話狀態: 40815e25-8c35-40d3-881d-2883e273a7f2
2025-08-18 22:14:05,926 - libs.mgfd_cursor.enhanced_slot_extractor - INFO - 增強型槽位提取，輸入: c...
2025-08-18 22:14:05,926 - libs.mgfd_cursor.enhanced_slot_extractor - INFO - 傳統提取未找到槽位，使用LLM智能分類
2025-08-18 22:14:05,926 - libs.mgfd_cursor.llm_manager - INFO - 執行槽位分類...
2025-08-18 22:14:05,926 - libs.mgfd_cursor.llm_manager - ERROR - 槽位分類失敗: 'MGFDLLMManager' object has no attribute '_get_from_cache'
2025-08-18 22:14:05,927 - libs.mgfd_cursor.enhanced_slot_extractor - WARNING - LLM分類置信度不足: 0.0
2025-08-18 22:14:05,927 - libs.mgfd_cursor.enhanced_slot_extractor - INFO - 槽位提取結果: {'timestamp': '2025-08-18T22:14:05.927035', 'user_input': 'c', 'extracted_slots': {}, 'extraction_method': 'failed'}
2025-08-18 22:14:05,927 - libs.mgfd_cursor.user_input_handler - INFO - 完整槽位提取結果: {'extracted_slots': {}, 'extraction_method': 'enhanced_extraction'}
2025-08-18 22:14:05,927 - libs.mgfd_cursor.user_input_handler - INFO - 提取方法: enhanced_extraction
2025-08-18 22:14:05,927 - libs.mgfd_cursor.user_input_handler - INFO - 實際提取的槽位: {}
2025-08-18 22:14:05,928 - libs.mgfd_cursor.redis_state_manager - INFO - 保存會話狀態: 40815e25-8c35-40d3-881d-2883e273a7f2
2025-08-18 22:14:05,928 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 當前狀態檢查:
2025-08-18 22:14:05,928 - libs.mgfd_cursor.mgfd_system - INFO -   - filled_slots: {'portability_need': 'balanced', 'usage_purpose': 'creative'}
2025-08-18 22:14:05,928 - libs.mgfd_cursor.mgfd_system - INFO -   - awaiting_prompt_response: True
2025-08-18 22:14:05,928 - libs.mgfd_cursor.mgfd_system - INFO -   - current_prompt_step: 2
2025-08-18 22:14:05,928 - libs.mgfd_cursor.mgfd_system - INFO -   - funnel_mode: True
2025-08-18 22:14:05,928 - libs.mgfd_cursor.mgfd_system - INFO -   - current_stage: awareness
2025-08-18 22:14:05,928 - libs.mgfd_cursor.mgfd_system - INFO - 等待回覆模式命中：step=2, slots={'portability_need': 'balanced', 'usage_purpose': 'creative'}
2025-08-18 22:14:05,928 - libs.mgfd_cursor.question_manager - INFO - DEBUG - QuestionManager.process_prompt_response:
2025-08-18 22:14:05,928 - libs.mgfd_cursor.question_manager - INFO -   - step: 2
2025-08-18 22:14:05,928 - libs.mgfd_cursor.question_manager - INFO -   - response: 'c'
2025-08-18 22:14:05,928 - libs.mgfd_cursor.question_manager - INFO -   - current_slots: {'portability_need': 'balanced', 'usage_purpose': 'creative'}
2025-08-18 22:14:05,928 - libs.mgfd_cursor.question_manager - INFO - DEBUG - 正規化輸入: 'c' -> upper: 'C'
2025-08-18 22:14:05,928 - libs.mgfd_cursor.question_manager - INFO - DEBUG - 字母鍵驗證結果: True
2025-08-18 22:14:05,928 - libs.mgfd_cursor.slot_mapping - INFO - Prompt轉換為槽位完成: 1 個槽位
2025-08-18 22:14:05,928 - libs.mgfd_cursor.question_manager - INFO - DEBUG - 步驟2字母鍵回覆成功: C -> {'budget_range': 'mid_range'}
2025-08-18 22:14:05,928 - libs.mgfd_cursor.question_manager - INFO - DEBUG - 最終更新後的槽位: {'portability_need': 'balanced', 'usage_purpose': 'creative', 'budget_range': 'mid_range'}
2025-08-18 22:14:05,928 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 槽位更新成功: {'portability_need': 'balanced', 'usage_purpose': 'creative'} -> {'portability_need': 'balanced', 'usage_purpose': 'creative', 'budget_range': 'mid_range'}
2025-08-18 22:14:05,928 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 狀態更新: awaiting_prompt_response=False, current_prompt_step=3
2025-08-18 22:14:05,929 - libs.mgfd_cursor.redis_state_manager - INFO - 保存會話狀態: 40815e25-8c35-40d3-881d-2883e273a7f2
2025-08-18 22:14:05,929 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 狀態已保存到 Redis
2025-08-18 22:14:05,929 - libs.mgfd_cursor.question_manager - INFO - 槽位已填充，跳過問題 Order 1: usage_purpose
2025-08-18 22:14:05,929 - libs.mgfd_cursor.question_manager - INFO - 槽位已填充，跳過問題 Order 2: budget_range
2025-08-18 22:14:05,929 - libs.mgfd_cursor.question_manager - INFO - 返回下一個問題 Order 3: release_time
INFO:     127.0.0.1:56561 - "POST /api/mgfd_cursor/chat HTTP/1.1" 200 OK
2025-08-18 22:14:24,279 - api.mgfd_routes - INFO - 處理聊天請求 - 會話ID: 40815e25-8c35-40d3-881d-2883e273a7f2, 消息: c...
2025-08-18 22:14:24,279 - libs.mgfd_cursor.mgfd_system - INFO - ========== 開始處理會話 40815e25-8c35-40d3-881d-2883e273a7f2 的消息: c... ==========
2025-08-18 22:14:24,280 - libs.mgfd_cursor.redis_state_manager - INFO - 載入會話狀態: 40815e25-8c35-40d3-881d-2883e273a7f2
2025-08-18 22:14:24,280 - libs.mgfd_cursor.enhanced_slot_extractor - INFO - 增強型槽位提取，輸入: c...
2025-08-18 22:14:24,280 - libs.mgfd_cursor.enhanced_slot_extractor - INFO - 傳統提取未找到槽位，使用LLM智能分類
2025-08-18 22:14:24,280 - libs.mgfd_cursor.llm_manager - INFO - 執行槽位分類...
2025-08-18 22:14:24,280 - libs.mgfd_cursor.llm_manager - ERROR - 槽位分類失敗: 'MGFDLLMManager' object has no attribute '_get_from_cache'
2025-08-18 22:14:24,280 - libs.mgfd_cursor.enhanced_slot_extractor - WARNING - LLM分類置信度不足: 0.0
2025-08-18 22:14:24,280 - libs.mgfd_cursor.enhanced_slot_extractor - INFO - 槽位提取結果: {'timestamp': '2025-08-18T22:14:24.280681', 'user_input': 'c', 'extracted_slots': {}, 'extraction_method': 'failed'}
2025-08-18 22:14:24,280 - libs.mgfd_cursor.user_input_handler - INFO - 完整槽位提取結果: {'extracted_slots': {}, 'extraction_method': 'enhanced_extraction'}
2025-08-18 22:14:24,280 - libs.mgfd_cursor.user_input_handler - INFO - 提取方法: enhanced_extraction
2025-08-18 22:14:24,280 - libs.mgfd_cursor.user_input_handler - INFO - 實際提取的槽位: {}
2025-08-18 22:14:24,282 - libs.mgfd_cursor.redis_state_manager - INFO - 保存會話狀態: 40815e25-8c35-40d3-881d-2883e273a7f2
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 當前狀態檢查:
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO -   - filled_slots: {'portability_need': 'balanced', 'usage_purpose': 'creative', 'budget_range': 'mid_range'}
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO -   - awaiting_prompt_response: False
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO -   - current_prompt_step: 3
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO -   - funnel_mode: True
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO -   - current_stage: awareness
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 檢查是否觸發 funnel chat
2025-08-18 22:14:24,282 - libs.mgfd_cursor.question_manager - INFO - 槽位已填充，跳過問題 Order 1: usage_purpose
2025-08-18 22:14:24,282 - libs.mgfd_cursor.question_manager - INFO - 槽位已填充，跳過問題 Order 2: budget_range
2025-08-18 22:14:24,282 - libs.mgfd_cursor.question_manager - INFO - 返回下一個問題 Order 3: release_time
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - _should_trigger_funnel_chat 結果: True
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 觸發funnel chat模式，設置 funnel_mode=True
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 決定下一步動作，funnel_mode: True
2025-08-18 22:14:24,282 - libs.mgfd_cursor.question_manager - INFO - 槽位已填充，跳過問題 Order 1: usage_purpose
2025-08-18 22:14:24,282 - libs.mgfd_cursor.question_manager - INFO - 槽位已填充，跳過問題 Order 2: budget_range
2025-08-18 22:14:24,282 - libs.mgfd_cursor.question_manager - INFO - 返回下一個問題 Order 3: release_time
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 槽位收集完成檢查: False
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 繼續收集槽位
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - _handle_slot_collection:
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO -   - current_slots: {'portability_need': 'balanced', 'usage_purpose': 'creative', 'budget_range': 'mid_range'}
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO -   - current_prompt_step: 3
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO -   - use_prompt_style: True
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - should_skip_to_search: False
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 使用Prompt風格，獲取步驟 3 的問題
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 獲取到問題: {'step': 3, 'question': '好的。請問您會多常需要帶著電腦外出使用呢？', 'type': 'choice', 'slot_name': 'portability', 'options': [{'key': 'A', 'text': '幾乎都在固定地點使用', 'value': 'desktop_replacement'}, {'key': 'B', 'text': '偶爾攜帶 (每週數次)', 'value': 'occasional'}, {'key': 'C', 'text': '經常攜帶 (幾乎每天)', 'value': 'frequent'}], 'transition': '好的。'}
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 格式化問題文字: 好的。好的。請問您會多常需要帶著電腦外出使用呢？

選項：
A) 幾乎都在固定地點使用
B) 偶爾攜帶 (每週數次)
C) 經常攜帶 (幾乎每天)...
2025-08-18 22:14:24,282 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 更新狀態設置: awaiting_prompt_response=True, current_prompt_step=3
2025-08-18 22:14:24,283 - libs.mgfd_cursor.redis_state_manager - INFO - 保存會話狀態: 40815e25-8c35-40d3-881d-2883e273a7f2
2025-08-18 22:14:24,283 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 狀態已保存完成
INFO:     127.0.0.1:56564 - "POST /api/mgfd_cursor/chat HTTP/1.1" 200 OK
2025-08-18 22:14:29,927 - api.mgfd_routes - INFO - 處理聊天請求 - 會話ID: 40815e25-8c35-40d3-881d-2883e273a7f2, 消息: c...
2025-08-18 22:14:29,927 - libs.mgfd_cursor.mgfd_system - INFO - ========== 開始處理會話 40815e25-8c35-40d3-881d-2883e273a7f2 的消息: c... ==========
2025-08-18 22:14:29,927 - libs.mgfd_cursor.redis_state_manager - INFO - 載入會話狀態: 40815e25-8c35-40d3-881d-2883e273a7f2
2025-08-18 22:14:29,928 - libs.mgfd_cursor.enhanced_slot_extractor - INFO - 增強型槽位提取，輸入: c...
2025-08-18 22:14:29,928 - libs.mgfd_cursor.enhanced_slot_extractor - INFO - 傳統提取未找到槽位，使用LLM智能分類
2025-08-18 22:14:29,928 - libs.mgfd_cursor.llm_manager - INFO - 執行槽位分類...
2025-08-18 22:14:29,928 - libs.mgfd_cursor.llm_manager - ERROR - 槽位分類失敗: 'MGFDLLMManager' object has no attribute '_get_from_cache'
2025-08-18 22:14:29,928 - libs.mgfd_cursor.enhanced_slot_extractor - WARNING - LLM分類置信度不足: 0.0
2025-08-18 22:14:29,928 - libs.mgfd_cursor.enhanced_slot_extractor - INFO - 槽位提取結果: {'timestamp': '2025-08-18T22:14:29.928365', 'user_input': 'c', 'extracted_slots': {}, 'extraction_method': 'failed'}
2025-08-18 22:14:29,928 - libs.mgfd_cursor.user_input_handler - INFO - 完整槽位提取結果: {'extracted_slots': {}, 'extraction_method': 'enhanced_extraction'}
2025-08-18 22:14:29,928 - libs.mgfd_cursor.user_input_handler - INFO - 提取方法: enhanced_extraction
2025-08-18 22:14:29,928 - libs.mgfd_cursor.user_input_handler - INFO - 實際提取的槽位: {}
2025-08-18 22:14:29,929 - libs.mgfd_cursor.redis_state_manager - INFO - 保存會話狀態: 40815e25-8c35-40d3-881d-2883e273a7f2
2025-08-18 22:14:29,929 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 當前狀態檢查:
2025-08-18 22:14:29,929 - libs.mgfd_cursor.mgfd_system - INFO -   - filled_slots: {'portability_need': 'balanced', 'usage_purpose': 'creative', 'budget_range': 'mid_range'}
2025-08-18 22:14:29,929 - libs.mgfd_cursor.mgfd_system - INFO -   - awaiting_prompt_response: True
2025-08-18 22:14:29,929 - libs.mgfd_cursor.mgfd_system - INFO -   - current_prompt_step: 3
2025-08-18 22:14:29,929 - libs.mgfd_cursor.mgfd_system - INFO -   - funnel_mode: True
2025-08-18 22:14:29,929 - libs.mgfd_cursor.mgfd_system - INFO -   - current_stage: awareness
2025-08-18 22:14:29,929 - libs.mgfd_cursor.mgfd_system - INFO - 等待回覆模式命中：step=3, slots={'portability_need': 'balanced', 'usage_purpose': 'creative', 'budget_range': 'mid_range'}
2025-08-18 22:14:29,929 - libs.mgfd_cursor.question_manager - INFO - DEBUG - QuestionManager.process_prompt_response:
2025-08-18 22:14:29,929 - libs.mgfd_cursor.question_manager - INFO -   - step: 3
2025-08-18 22:14:29,929 - libs.mgfd_cursor.question_manager - INFO -   - response: 'c'
2025-08-18 22:14:29,929 - libs.mgfd_cursor.question_manager - INFO -   - current_slots: {'portability_need': 'balanced', 'usage_purpose': 'creative', 'budget_range': 'mid_range'}
2025-08-18 22:14:29,929 - libs.mgfd_cursor.question_manager - INFO - DEBUG - 正規化輸入: 'c' -> upper: 'C'
2025-08-18 22:14:29,929 - libs.mgfd_cursor.question_manager - INFO - DEBUG - 字母鍵驗證結果: True
2025-08-18 22:14:29,930 - libs.mgfd_cursor.slot_mapping - INFO - Prompt轉換為槽位完成: 1 個槽位
2025-08-18 22:14:29,930 - libs.mgfd_cursor.question_manager - INFO - DEBUG - 步驟3字母鍵回覆成功: C -> {'portability': 'frequent'}
2025-08-18 22:14:29,930 - libs.mgfd_cursor.question_manager - INFO - DEBUG - 最終更新後的槽位: {'portability_need': 'balanced', 'usage_purpose': 'creative', 'budget_range': 'mid_range', 'portability': 'frequent'}
2025-08-18 22:14:29,930 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 槽位更新成功: {'portability_need': 'balanced', 'usage_purpose': 'creative', 'budget_range': 'mid_range'} -> {'portability_need': 'balanced', 'usage_purpose': 'creative', 'budget_range': 'mid_range', 'portability': 'frequent'}
2025-08-18 22:14:29,930 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 狀態更新: awaiting_prompt_response=False, current_prompt_step=4
2025-08-18 22:14:29,931 - libs.mgfd_cursor.redis_state_manager - INFO - 保存會話狀態: 40815e25-8c35-40d3-881d-2883e273a7f2
2025-08-18 22:14:29,931 - libs.mgfd_cursor.mgfd_system - INFO - DEBUG - 狀態已保存到 Redis
2025-08-18 22:14:29,931 - libs.mgfd_cursor.mgfd_system - INFO - 使用chunking搜尋引擎進行產品搜尋，槽位: {'portability_need': 'balanced', 'usage_purpose': 'creative', 'budget_range': 'mid_range', 'portability': 'frequent'}
2025-08-18 22:14:29,931 - libs.mgfd_cursor.knowledge_base - INFO - 使用Chunking引擎搜索產品: {'portability_need': 'balanced', 'usage_purpose': 'creative', 'budget_range': 'mid_range', 'portability': 'frequent'}
Batches: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  8.82it/s]
2025-08-18 22:14:30,051 - libs.mgfd_cursor.knowledge_base - INFO - 語義搜尋找到 8 個產品
2025-08-18 22:14:30,052 - libs.mgfd_cursor.redis_state_manager - INFO - 保存會話狀態: 40815e25-8c35-40d3-881d-2883e273a7f2
INFO:     127.0.0.1:56574 - "POST /api/mgfd_cursor/chat HTTP/1.1" 200 OK
2025-08-18 22:14:40,044 - watchfiles.main - INFO - 1 change detected
INFO:     127.0.0.1:56598 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
2025-08-18 22:14:40,876 - watchfiles.main - INFO - 3 changes detected
2025-08-18 22:14:41,501 - watchfiles.main - INFO - 4 changes detected
2025-08-18 22:14:57,272 - watchfiles.main - INFO - 1 change detected
2025-08-18 22:15:30,405 - watchfiles.main - INFO - 2 changes detected
2025-08-18 22:15:42,009 - watchfiles.main - INFO - 3 changes detected
2025-08-18 22:16:12,457 - watchfiles.main - INFO - 2 changes detected
2025-08-18 22:16:33,394 - watchfiles.main - INFO - 2 changes detected
2025-08-18 22:16:34,712 - watchfiles.main - INFO - 1 change detected
2025-08-18 22:16:36,779 - watchfiles.main - INFO - 2 changes detected
2025-08-18 22:16:42,063 - watchfiles.main - INFO - 2 changes detected