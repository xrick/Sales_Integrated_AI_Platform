# 功能缺失表

> 依據 `libs/RAG` 目錄下現有程式碼盤點主要缺口，並依影響度排序。

| 模組/範疇 | 現況觀察 | 缺失功能 | 影響 | 優先層級 |
| --- | --- | --- | --- | --- |
| `DB/DatabaseQuery.py` | 僅定義同步 `connect/query/disconnect`，無其他介面 | 缺少統一的例外基底類別與 context manager 協定（`__enter__/__exit__`） | 難以保證連線資源安全釋放，對後續多資料庫整合造成阻力 | 高 |
| `DB/DuckDBQuery.py` | 初始化立即連線、以 `print` 訊息記錄 | 缺少自動重連與連線池、沒有只讀保護切換、無結構化 log | 錯誤偵測依賴 stdout，難以在服務端追蹤異常或切換運行模式 | 中 |
| `DB/DuckDBQuery.py` | 僅提供 `query` 及 `query_with_params` | 缺少 schema 輔助（欄位型別、DataFrame 介面）與串流查詢 | 大型查詢需一次載入記憶體，限制擴充性 | 中 |
| `DB/MilvusQuery.py` | 以 `HuggingFaceEmbeddings` 向量化、欄位清單硬編碼 | 缺少透過設定檔載入模型與 collection schemas，亦未支援 filter / rerank | 無法在多 collection 或 schema 變動時重複使用，易產生欄位不同步 | 高 |
| `DB/MilvusQuery.py` | 直接回傳 `list[dict]` | 缺少統一資料傳輸物件（DTO）或標準化欄位說明 | 前端/後端整合需自行猜測欄位意義，增加整合成本 | 中 |
| `LLM/LLMInitializer.py` | 提供 `safe_completion/complete`，鎖定 Ollama 單一後端 | 缺少模型健康檢查、fallback 與 stream 輸出支援 | LLM 服務故障時整體功能中斷，無法擴充到雲端 API | 高 |
| `LLM/DSPyLLMInitializer.py` | 空白檔案 | 缺少 DSPy 模型初始化實作 | 文件與實作不一致，無法支援宣稱的 DSPy 流程 | 高 |
| `LLM/LLM_Usage_Example.py` | 直接示範呼叫 | 缺少 import、錯誤處理與單元測試 | 說明文件無法直接運行，難以作為回歸測試案例 | 低 |
| `Tools/ContentSpliter.py` | 提供 Markdown 與純文字切割 | 缺少多語 chunk 正規化、原檔案資訊回填與 tokenizer 選擇 | 下游檢索難以做語系判斷，易出現重複或破碎段落 | 中 |
| 系統層 | 各模組獨立存在 | 缺少統一的 RAG Pipeline Orchestrator（檔載→切割→索引→檢索→生成） | 需要在業務邏輯層手動組裝流程，難以測試與重複使用 | 高 |
| 系統層 | 無測試專案 | 缺少針對資料庫、LLM 與工具層的單元/整合測試 | 無基準測試即進行調整，風險高 | 高 |
