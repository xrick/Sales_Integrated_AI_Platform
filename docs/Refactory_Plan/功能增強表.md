# 功能增強表

> 依模組提出可逐步納入的改善項目，評估價值與所需資源。

| 模組/範疇 | 建議增強 | 預期效益 | 建議時程 |
| --- | --- | --- | --- |
| `DB/DatabaseQuery.py` | 擴充為 `ContextVar`/`contextmanager` 介面，並提供自訂例外 | 統一資料庫操作方式、減少遺漏 `disconnect` 的風險 | 短期 |
| `DB/DuckDBQuery.py` | 封裝 `duckdb.connect` 為延遲連線 + 連線重用，導入 `logging` | 提升穩定度與可觀測性，避免頻繁建立連線 | 短期 |
| `DB/DuckDBQuery.py` | 增加 `to_dataframe`/`yield_batches` 等 API | 方便與 Pandas / Arrow 整合，支援大型查詢 | 中期 |
| `DB/MilvusQuery.py` | 透過 `config.py` 或 `.env` 管理主機、collection 及欄位設定 | 快速切換環境與 schema，減少硬編碼維護成本 | 短期 |
| `DB/MilvusQuery.py` | 更新嵌入模型至 `langchain_huggingface`，加入 rerank 與 filter | 改善檢索精度，順應新版套件 | 中期 |
| `LLM/LLMInitializer.py` | 加入健康檢查、fallback 模型與串流（callback）支援 | 降低 LLM 宕機風險，改善長輸出體驗 | 中期 |
| `LLM/DSPyLLMInitializer.py` | 實作 DSPy `LM`/`Pipeline` 包裝，提供示例 | 讓團隊可嘗試 DSPy「規格化 prompts」實驗 | 中期 |
| `LLM/LLMInitializer.py` & `Tools/ContentSpliter.py` | 對接 tokenizer-aware splitter（如 `tiktoken`） | 避免多語環境 chunk 過長或過短 | 中期 |
| `Tools/ContentSpliter.py` | 回填 `source_path`、`page` 等 metadata，並支援多檔案格式 | 提升檢索結果可追溯性 | 短期 |
| 系統層 | 組合成 `RAGPipeline`（資料擷取 → 切割 → 索引 → 檢索 → 生成） | 讓服務層只需呼叫單一入口，提升重用性 | 中期 |
| 系統層 | 建立 `pytest` smoke tests 與合約測試 | 提供回歸保護，為後續 refactor 增加信心 | 短期 |
