å¾Œç«¯JSONå›æ‡‰å‚³é€åˆ°å‰ç«¯ç€è¦½å™¨çš„ç¨‹å¼ä½ç½®åˆ†æ                                              â”‚
     â”‚                                                                                         â”‚
     â”‚ é€šéåˆ†æä»£ç¢¼ï¼Œæˆ‘å·²æ‰¾åˆ°å¾Œç«¯å°‡JSONæè¿°çš„çµæœå‚³é€çµ¦å‰ç«¯ç€è¦½å™¨çš„é—œéµç¨‹å¼ä½ç½®ï¼š              â”‚
     â”‚                                                                                         â”‚
     â”‚ ğŸ¯ ä¸»è¦JSONå‚³é€ä½ç½®                                                                     â”‚
     â”‚                                                                                         â”‚
     â”‚ 1. APIè·¯ç”±å±¤ - ç›´æ¥JSONå›æ‡‰                                                             â”‚
     â”‚                                                                                         â”‚
     â”‚ æª”æ¡ˆ: /api/mgfd_routes.py                                                               â”‚
     â”‚ - ç¬¬55-88è¡Œ: /chat ç«¯é» - æ¨™æº–JSONå›æ‡‰                                                  â”‚
     â”‚ - ç¬¬80è¡Œ: return ChatResponse(**result) - å°‡çµæœåŒ…è£æˆJSONå›æ‡‰                          â”‚
     â”‚                                                                                         â”‚
     â”‚ 2. APIè·¯ç”±å±¤ - ä¸²æµJSONå›æ‡‰                                                             â”‚
     â”‚                                                                                         â”‚
     â”‚ æª”æ¡ˆ: /api/mgfd_routes.py                                                               â”‚
     â”‚ - ç¬¬91-139è¡Œ: /chat/stream ç«¯é» - Server-Sent Eventsæ ¼å¼                                â”‚
     â”‚ - ç¬¬116è¡Œ: yield f"data: {json.dumps({'type': 'start', 'session_id': session_id})}\n\n" â”‚
     â”‚ - ç¬¬119è¡Œ: yield f"data: {json.dumps(result, ensure_ascii=False)}\n\n"                  â”‚
     â”‚ - ç¬¬122è¡Œ: yield f"data: {json.dumps({'type': 'end', 'session_id': session_id})}\n\n"   â”‚
     â”‚                                                                                         â”‚
     â”‚ 3. æ ¸å¿ƒç³»çµ±å±¤ - å›æ‡‰æ ¼å¼åŒ–                                                              â”‚
     â”‚                                                                                         â”‚
     â”‚ æª”æ¡ˆ: /libs/MGFDKernel.py                                                               â”‚
     â”‚ - ç¬¬584-643è¡Œ: _format_frontend_response() æ–¹æ³•                                         â”‚
     â”‚ - ç¬¬601-643è¡Œ: æ ¹æ“šä¸åŒç‹€æ…‹æ ¼å¼åŒ–JSONçµæ§‹:                                              â”‚
     â”‚   - funnel_start (ç¬¬602-607è¡Œ)                                                          â”‚
     â”‚   - funnel_question (ç¬¬608-618è¡Œ)                                                       â”‚
     â”‚   - recommendation (ç¬¬619-627è¡Œ)                                                        â”‚
     â”‚   - elicitation (ç¬¬628-635è¡Œ)                                                           â”‚
     â”‚   - general (ç¬¬637-643è¡Œ)                                                               â”‚
     â”‚                                                                                         â”‚
     â”‚ 4. å›æ‡‰ç”Ÿæˆå±¤ - å‰ç«¯æ ¼å¼é©é…                                                            â”‚
     â”‚                                                                                         â”‚
     â”‚ æª”æ¡ˆ: /libs/ResponseGenHandler/ResponseGenHandler.py                                    â”‚
     â”‚ - ç¬¬481-530è¡Œ: _adapt_frontend_format() æ–¹æ³•                                            â”‚
     â”‚ - ç¬¬492-527è¡Œ: é©é…ä¸åŒå›æ‡‰é¡å‹åˆ°å‰ç«¯æœŸæœ›æ ¼å¼                                           â”‚
     â”‚                                                                                         â”‚
     â”‚ 5. ä¸»æ‡‰ç”¨ç¨‹å¼å±¤ - å…¨åŸŸJSONç·¨ç¢¼å™¨                                                        â”‚
     â”‚                                                                                         â”‚
     â”‚ æª”æ¡ˆ: /main.py                                                                          â”‚
     â”‚ - ç¬¬35-46è¡Œ: NumpyJSONEncoder é¡åˆ¥ - è™•ç†numpyé¡å‹                                      â”‚
     â”‚ - ç¬¬68-75è¡Œ: CustomJSONResponse é¡åˆ¥ - è‡ªå®šç¾©JSONå›æ‡‰                                   â”‚
     â”‚ - ç¬¬71-75è¡Œ: json.dumps() èª¿ç”¨ï¼Œè¨­å®š ensure_ascii=False å’Œè‡ªå®šç¾©ç·¨ç¢¼å™¨                  â”‚
     â”‚ - ç¬¬78è¡Œ: è¨­å®šç‚ºæ‡‰ç”¨ç¨‹å¼é è¨­å›æ‡‰é¡åˆ¥                                                    â”‚
     â”‚                                                                                         â”‚
     â”‚ ğŸ”„ JSONå‚³é€æµç¨‹                                                                         â”‚
     â”‚                                                                                         â”‚
     â”‚ 1. ç”¨æˆ¶è«‹æ±‚ â†’ APIè·¯ç”± (mgfd_routes.py)                                                  â”‚
     â”‚ 2. æ¥­å‹™è™•ç† â†’ MGFDKernel (MGFDKernel.py)                                                â”‚
     â”‚ 3. å›æ‡‰ç”Ÿæˆ â†’ ResponseGenHandler (ResponseGenHandler.py)                                â”‚
     â”‚ 4. æ ¼å¼é©é… â†’ _format_frontend_response() / _adapt_frontend_format()                    â”‚
     â”‚ 5. JSONç·¨ç¢¼ â†’ CustomJSONResponse (main.py)                                              â”‚
     â”‚ 6. å‚³é€åˆ°ç€è¦½å™¨ â†’ HTTPå›æ‡‰/SSEä¸²æµ                                                      â”‚
     â”‚                                                                                         â”‚
     â”‚ ğŸ“‹ é—œéµJSONæ ¼å¼                                                                         â”‚
     â”‚                                                                                         â”‚
     â”‚ ä¸€èˆ¬å›æ‡‰æ ¼å¼:                                                                           â”‚
     â”‚ {                                                                                       â”‚
     â”‚   "success": true,                                                                      â”‚
     â”‚   "type": "general",                                                                    â”‚
     â”‚   "message": "å›æ‡‰å…§å®¹",                                                                â”‚
     â”‚   "session_id": "æœƒè©±ID",                                                               â”‚
     â”‚   "timestamp": "æ™‚é–“æˆ³"                                                                 â”‚
     â”‚ }                                                                                       â”‚
     â”‚                                                                                         â”‚
     â”‚ ä¸²æµå›æ‡‰æ ¼å¼:                                                                           â”‚
     â”‚ data: {"type": "start", "session_id": "xxx"}                                            â”‚
     â”‚ data: {"success": true, "type": "general", "message": "å…§å®¹"}                           â”‚
     â”‚ data: {"type": "end", "session_id": "xxx"}                                              â”‚
     â”‚                                                                                         â”‚
     â”‚ æ‰€æœ‰JSONå›æ‡‰éƒ½ä½¿ç”¨ ensure_ascii=False ç¢ºä¿ä¸­æ–‡å­—ç¬¦æ­£ç¢ºé¡¯ç¤ºã€‚